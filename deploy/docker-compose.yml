version: '3.8'

services:
  # FastAPI 백엔드
  backend:
    build:
      context: ../backend
      dockerfile: Dockerfile
    container_name: ${PROJECT_NAME:-ai-stock-trading}-backend
    ports:
      - "8000:8000"
    environment:
      - KIS_APP_KEY=${KIS_APP_KEY}
      - KIS_APP_SECRET=${KIS_APP_SECRET}
      - KIS_ACCOUNT_NO=${KIS_ACCOUNT_NO}
      - KIS_ACCOUNT_PRODUCT_CD=${KIS_ACCOUNT_PRODUCT_CD:-02}
      - KIS_BASE_URL=${KIS_BASE_URL:-https://openapivts.koreainvestment.com:29443}
      - DATABASE_URL=${DATABASE_URL:-sqlite:///./trading.db}
      - BACKEND_HOST=0.0.0.0
      - BACKEND_PORT=8000
      - FRONTEND_URL=${FRONTEND_URL:-http://localhost:3000}
      - USE_MOCK_DATA=${USE_MOCK_DATA:-False}
    volumes:
      - ../backend:/app
      - backend_data:/app/data
    restart: unless-stopped
    networks:
      - trading-network

  # Nginx (프론트엔드 서빙 및 리버스 프록시)
  nginx:
    image: nginx:alpine
    container_name: ${PROJECT_NAME:-ai-stock-trading}-nginx
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
      - ../frontend/dist:/usr/share/nginx/html:ro
    depends_on:
      - backend
    restart: unless-stopped
    networks:
      - trading-network

volumes:
  backend_data:

networks:
  trading-network:
    driver: bridge

